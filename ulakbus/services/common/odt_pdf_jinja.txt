@startuml
autonumber
actor ItsMe
boundary Zato
control CZato
control S3
control RenderDocument
control DocsBoxPDF
ItsMe -> Zato : Send odt file and jinja variables.
Zato -> CZato : Pass previous payloads.
CZato -> RenderDocument : Make request with payloads, template and context.
RenderDocument -> RenderDocument : Render document with jinja and secretary.
RenderDocument -> S3 : Save rendered document to S3.
S3 -> RenderDocument : URL of the saved document.
RenderDocument -> CZato : Send the S3 URL of the saved document
CZato -> S3 : Get file content.
S3 -> CZato : File content.
CZato -> CZato : Convert file-like object the response of S3
CZato -> DocsBoxPDF : Send file-like object via HTTP Multipart.
DocsBoxPDF -> DocsBoxPDF : Add task to queue.
DocsBoxPDF -> CZato : Send task id.
CZato -> DocsBoxPDF : Until the status of task is finished, Make request in given seconds.
DocsBoxPDF -> DocsBoxPDF : Check scheduler and convert files on queue to pdf file.
DocsBoxPDF -> CZato : Send back the response of requests. i.e status, result_url.
CZato -> DocsBoxPDF : Get file on the result_url.
DocsBoxPDF -> CZato : Send content of file.
CZato -> CZato : Convert file content to BytesIO object.
CZato -> S3 : Save BytesIO object. It's PDF.
S3 -> CZato : Send URL of saved document
CZato -> Zato : Send the url
Zato -> ItsMe : Send the payload
@enduml
